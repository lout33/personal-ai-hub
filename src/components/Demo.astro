---
const conversation = [
  {
    type: 'notification',
    content: 'HEARTBEAT: Screen check',
    time: '2:30 PM'
  },
  {
    type: 'system',
    content: 'Reading screen activity... Reading NOW.md...\nMIT: "Ship the landing page"\nDeadline: Feb 28 (14 days)'
  },
  {
    type: 'heartbeat',
    content: "[14:30] DOING: VS Code - building landing page components\nSHOULD: Ship landing page\nDEADLINE: Feb 28 (14 days)\nFlow state. Keep going.",
    time: '2:30 PM',
    tone: 'aligned'
  },
  {
    type: 'notification',
    content: 'HEARTBEAT: Screen check',
    time: '3:00 PM'
  },
  {
    type: 'heartbeat',
    content: "[15:00] DOING: YouTube - watching programming tutorials (25 min)\nSHOULD: Ship landing page\nDEADLINE: Feb 28 (14 days)\nYou know what you should be doing.",
    time: '3:00 PM',
    tone: 'distraction'
  },
  {
    type: 'notification',
    content: 'HEARTBEAT: Screen check',
    time: '3:30 PM'
  },
  {
    type: 'heartbeat',
    content: "[15:30] DOING: Twitter/X - scrolling feed (15 min)\nSHOULD: Ship landing page\nDEADLINE: Feb 28 (14 days)\n45 min off track. The landing page won't ship itself.",
    time: '3:30 PM',
    tone: 'escalated'
  },
  {
    type: 'user',
    content: "Fine. You're right. Going back to VS Code."
  },
  {
    type: 'notification',
    content: 'HEARTBEAT: Screen check',
    time: '4:00 PM'
  },
  {
    type: 'heartbeat',
    content: "[16:00] DOING: VS Code - implementing hero section\nSHOULD: Ship landing page\nDEADLINE: Feb 28 (14 days)\nBack on track. Keep going.",
    time: '4:00 PM',
    tone: 'aligned'
  },
  {
    type: 'notification',
    content: 'HEARTBEAT: Screen check',
    time: '4:30 PM'
  },
  {
    type: 'heartbeat',
    content: "[16:30] DOING: VS Code + Chrome - building + testing landing page\nSHOULD: Ship landing page\nDEADLINE: Feb 28 (14 days)\n90 min deep work. Don't stop now.",
    time: '4:30 PM',
    tone: 'aligned'
  },
  {
    type: 'notification',
    content: 'Y Combinator W26 application closes TODAY 8pm PT',
    time: '4:47 PM',
    urgent: true
  },
  {
    type: 'agent',
    content: "Wait. I was scanning opportunities from your GOALS.md and found something.\n\nY Combinator W26 batch application closes TODAY at 8pm PT. You mentioned wanting to apply \"someday.\"\n\nYou have 3 hours. Your landing page can wait. This can't.\n\nYour MVP is live. You have traction. Want me to help draft the application?"
  },
  {
    type: 'user',
    content: "Holy shit. Yes. Let's do it."
  },
  {
    type: 'system',
    content: `NOW.md updated:

# QUEUE
- [ ] YC W26 Application - URGENT - Due 8pm PT today
- [ ] Ship landing page (moved to tomorrow)

# LOG
### Feb 14
- HEARTBEAT caught 45min distraction. Called out. Back on track.
- Proactive alert: YC deadline closing today. Priorities shifted.
- Quote: "Holy shit. Yes. Let's do it." - This is the energy.`
  },
  {
    type: 'agent',
    content: "NOW.md updated. Priorities shifted.\n\nLet's write an application that ships. Not a perfect one. A real one.\n\nFirst question: Describe what your company does in 50 characters or less."
  }
];
---

<section id="demo" class="py-20 px-6 relative">
  <!-- Telegram notification popup -->
  <div id="telegram-notification" class="fixed top-4 right-4 z-50 transform translate-x-full opacity-0 transition-all duration-500">
    <div class="bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl border border-zinc-200 dark:border-zinc-700 p-4 max-w-sm">
      <div class="flex items-start gap-3">
        <div class="w-10 h-10 rounded-full bg-[#0088cc] flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
          </svg>
        </div>
        <div class="flex-1 min-w-0">
          <div class="flex items-center gap-2">
            <span class="font-semibold text-sm">Symbiotic Agent</span>
            <span id="notif-time" class="text-xs text-zinc-500">2:47 PM</span>
          </div>
          <p id="notif-content" class="text-sm text-zinc-600 dark:text-zinc-400 mt-0.5 truncate">/check-day triggered</p>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-4xl mx-auto">
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold mb-4">HEARTBEAT In Action</h2>
      <p class="text-zinc-600 dark:text-zinc-400 max-w-xl mx-auto">
        Your AI watches your screen every 30 minutes. Quiet when you're focused. Direct when you drift.
      </p>
    </div>

    <div class="bg-zinc-950 rounded-2xl overflow-hidden border border-zinc-800">
      <!-- Chat header -->
      <div class="flex items-center justify-between px-4 py-3 border-b border-zinc-800">
        <div class="flex items-center gap-3">
          <div class="flex gap-1.5">
            <div class="w-3 h-3 rounded-full bg-red-500"></div>
            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
            <div class="w-3 h-3 rounded-full bg-green-500"></div>
          </div>
          <span class="text-sm text-zinc-400 font-mono">symbiotic-agent</span>
        </div>
        <div class="flex items-center gap-2 text-xs text-zinc-500">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
          </svg>
          <span>HEARTBEAT via Telegram</span>
        </div>
      </div>

      <!-- Chat messages -->
      <div id="chat-container" class="p-4 h-[400px] overflow-y-auto space-y-4">
        <!-- Messages will be inserted here -->
      </div>

      <!-- Controls -->
      <div class="px-4 py-3 border-t border-zinc-800 flex items-center justify-between">
        <div class="text-sm text-zinc-500">
          <span id="step-indicator">Click Next to start</span>
        </div>
        <div class="flex gap-2">
          <button id="restart-btn" class="px-3 py-1.5 rounded-lg text-sm text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors">
            Restart
          </button>
          <button id="next-btn" class="px-4 py-1.5 rounded-lg text-sm bg-emerald-500 hover:bg-emerald-600 text-white font-medium transition-colors">
            Next
          </button>
        </div>
      </div>
    </div>

    <div class="flex items-center justify-center gap-6 mt-6 text-sm text-zinc-500">
      <div class="flex items-center gap-2">
        <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
        <span>Screen monitoring</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-2 h-2 rounded-full bg-blue-500"></div>
        <span>Telegram delivery</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-2 h-2 rounded-full bg-amber-500"></div>
        <span>Adaptive tone</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-2 h-2 rounded-full bg-purple-500"></div>
        <span>Powered by OpenClaw</span>
      </div>
    </div>
  </div>
</section>

<script define:vars={{ conversation }}>
  const container = document.getElementById('chat-container');
  const nextBtn = document.getElementById('next-btn');
  const restartBtn = document.getElementById('restart-btn');
  const stepIndicator = document.getElementById('step-indicator');
  const notification = document.getElementById('telegram-notification');
  const notifContent = document.getElementById('notif-content');
  const notifTime = document.getElementById('notif-time');
  
  let currentStep = 0;

  function showNotification(content, time, urgent = false) {
    notifContent.textContent = content;
    notifTime.textContent = time;
    
    // Update styling for urgent notifications
    const notifBox = notification.querySelector('div');
    if (urgent) {
      notifBox.classList.add('ring-2', 'ring-red-500', 'ring-offset-2');
      notifContent.classList.add('text-red-600', 'dark:text-red-400', 'font-semibold');
      notifContent.classList.remove('text-zinc-600', 'dark:text-zinc-400');
    } else {
      notifBox.classList.remove('ring-2', 'ring-red-500', 'ring-offset-2');
      notifContent.classList.remove('text-red-600', 'dark:text-red-400', 'font-semibold');
      notifContent.classList.add('text-zinc-600', 'dark:text-zinc-400');
    }
    
    notification.classList.remove('translate-x-full', 'opacity-0');
    notification.classList.add('translate-x-0', 'opacity-100');
    
    // Auto-hide after 4 seconds (longer for urgent)
    setTimeout(() => {
      notification.classList.add('translate-x-full', 'opacity-0');
      notification.classList.remove('translate-x-0', 'opacity-100');
    }, urgent ? 5000 : 3000);
  }

  function createMessage(msg) {
    // Handle notification type
    if (msg.type === 'notification') {
      showNotification(msg.content, msg.time, msg.urgent || false);
      return;
    }

    const div = document.createElement('div');
    
    if (msg.type === 'heartbeat') {
      const toneColors = {
        aligned: { border: 'border-emerald-500/30', bg: 'bg-emerald-500/10', dot: 'bg-emerald-500', label: 'Aligned' },
        distraction: { border: 'border-amber-500/30', bg: 'bg-amber-500/10', dot: 'bg-amber-500', label: 'Off track' },
        escalated: { border: 'border-red-500/30', bg: 'bg-red-500/10', dot: 'bg-red-500', label: 'Escalated' },
      };
      const tone = toneColors[msg.tone] || toneColors.aligned;
      div.className = 'flex justify-start';
      div.innerHTML = `
        <div class="flex gap-3 max-w-[90%] w-full">
          <div class="w-8 h-8 rounded-full bg-[#0088cc] flex items-center justify-center flex-shrink-0">
            <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
            </svg>
          </div>
          <div class="flex-1 px-4 py-3 rounded-2xl rounded-tl-none ${tone.border} ${tone.bg} border">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-2 h-2 rounded-full ${tone.dot}"></div>
              <span class="text-xs font-medium text-zinc-400">${tone.label}</span>
              <span class="text-xs text-zinc-500 ml-auto">${msg.time}</span>
            </div>
            <pre class="text-sm text-zinc-200 font-mono whitespace-pre-wrap leading-relaxed">${msg.content}</pre>
          </div>
        </div>
      `;
    } else if (msg.type === 'system') {
      div.className = 'flex justify-center';
      div.innerHTML = `
        <div class="px-4 py-2 rounded-lg bg-zinc-800/50 border border-zinc-700 max-w-md">
          <pre class="text-xs text-zinc-400 font-mono whitespace-pre-wrap">${msg.content}</pre>
        </div>
      `;
    } else if (msg.type === 'agent') {
      div.className = 'flex justify-start';
      div.innerHTML = `
        <div class="flex gap-3 max-w-[85%]">
          <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center flex-shrink-0">
            <span class="text-xs">AI</span>
          </div>
          <div class="px-4 py-2 rounded-2xl rounded-tl-none bg-zinc-800 text-zinc-100">
            <p class="text-sm whitespace-pre-wrap">${msg.content}</p>
          </div>
        </div>
      `;
    } else {
      div.className = 'flex justify-end';
      div.innerHTML = `
        <div class="flex gap-3 max-w-[85%]">
          <div class="px-4 py-2 rounded-2xl rounded-tr-none bg-emerald-600 text-white">
            <p class="text-sm whitespace-pre-wrap">${msg.content}</p>
          </div>
          <div class="w-8 h-8 rounded-full bg-emerald-700 flex items-center justify-center flex-shrink-0">
            <span class="text-xs">You</span>
          </div>
        </div>
      `;
    }

    div.style.opacity = '0';
    div.style.transform = 'translateY(10px)';
    container.appendChild(div);
    
    // Animate in
    requestAnimationFrame(() => {
      div.style.transition = 'opacity 0.3s, transform 0.3s';
      div.style.opacity = '1';
      div.style.transform = 'translateY(0)';
    });

    // Scroll to bottom
    container.scrollTop = container.scrollHeight;
  }

  function updateIndicator() {
    if (currentStep === 0) {
      stepIndicator.textContent = 'Click Next to start';
    } else {
      stepIndicator.textContent = `Step ${currentStep} of ${conversation.length}`;
    }
    
    if (currentStep >= conversation.length) {
      nextBtn.textContent = 'Done';
      nextBtn.disabled = true;
      nextBtn.className = 'px-4 py-1.5 rounded-lg text-sm bg-zinc-700 text-zinc-400 cursor-not-allowed';
    }
  }

  function showNext() {
    if (currentStep < conversation.length) {
      createMessage(conversation[currentStep]);
      currentStep++;
      updateIndicator();
    }
  }

  function restart() {
    container.innerHTML = '';
    currentStep = 0;
    nextBtn.textContent = 'Next';
    nextBtn.disabled = false;
    nextBtn.className = 'px-4 py-1.5 rounded-lg text-sm bg-emerald-500 hover:bg-emerald-600 text-white font-medium transition-colors';
    updateIndicator();
    // Hide notification if visible
    notification.classList.add('translate-x-full', 'opacity-0');
    notification.classList.remove('translate-x-0', 'opacity-100');
  }

  nextBtn.addEventListener('click', showNext);
  restartBtn.addEventListener('click', restart);

  // Initial state
  updateIndicator();
</script>
